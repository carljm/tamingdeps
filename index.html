<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Taming dependencies with pip</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  
    <link rel="stylesheet" href="file/style.css" type="text/css"/>
  

  
    <script type="text/javascript" src="file/timer.js"></script>
  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content smaller intro" ref="title/01_title">
<h1>Taming your dependencies with pip</h1>

<p><img src="./file/title/logo.png" alt="OddBird"/></p>

<h2>Carl J Meyer</h2>

<h2>@carljm</h2>

<h2>carl@oddbird.net</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="basics/10_problem/1">
<h2>dependencies are painful</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="basics/10_problem/2">
<h2>even Django hates them</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="basics/10_problem/3">
<pre class="sh_python"><code>from django.utils import unittest</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="basics/10_problem/4">
<h2>but you don't have to!</h2></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="basics/10_problem/5">
<h2>scope</h2>

<ul>
<li>a web project</li>
<li>not a library</li>
<li>not an end-user program</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="basics/10_problem/6">
<h2>deployment desiderata</h2>

<ul>
<li>repeatable</li>
<li>reliable</li>
<li>fast</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="basics/15_virtualenv">
<h2>virtualenv</h2>

<ul>
<li>use it</li>
<li>use <code>--no-site-packages</code></li>
<li>recreate freely and often</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="basics/20_pip">
<h1>pip!</h1>

<h3>by Ian Bicking</h3>

<h3>"Pip Installs (Python) Packages"</h3></div>
</div><div class="slide" data-transition="none"><div class="content" ref="easywins/10_requirements/1">
<h2>the pip requirements file</h2>

<pre class="sh_"><code>Django==1.3

South==0.7.3
django-compressor==0.9.2
BeautifulSoup==3.2.0
slimmer==0.1.30
django-floppyforms==0.4.2
django-classy-tags==0.3.0
...</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="easywins/10_requirements/2">
<h2>habits for highly effective requirements files</h2>

<ul>
<li>pin everything</li>
<li>(even deps of deps)</li>
<li>pin exactly</li>
<li><code>Django==1.2.5</code>, not <code>Django&gt;=1.2,&lt;1.3</code></li>
<li>test regularly in a clean venv</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental nobullets" ref="easywins/10_requirements/3">
<h2>how it works</h2>

<ul>
<li><code>Django==1.3</code></li>
<li>default "index url": <code>http://pypi.python.org/simple/</code></li>
<li><code>http://pypi.python.org/simple/Django/1.3</code></li>
<li><code>http://pypi.python.org/simple/Django/</code></li>
<li>link scraping, wheee!</li>
<li><code>rel=[homepage,download]</code> or links that look like PyPI home/download links</li>
<li>archive files (zip/tar) named like <code>Django-1.3.tar.gz</code> - "sdists"</li>
<li>picks highest found version that fits criterion</li>
<li>use <code>pip install -vv ...</code> to debug</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="easywins/20_options/1">
<h2>re-downloading is too slow</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="easywins/20_options/2">
<p>in <code>~/.pip/pip.conf</code>:</p>

<pre class="sh_ini"><code>[global]
download-cache=/path/to/some/dir</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="easywins/20_options/3">
<p><code>PIP_DOWNLOAD_CACHE=/path/to/some/dir</code></p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="easywins/20_options/4">
<h2>oh noes! PyPI is down!</h2></div>
</div><div class="slide" data-transition="none"><div class="content" ref="easywins/20_options/5">
<p>in <code>~/.pip/pip.conf</code>:</p>

<pre class="sh_ini"><code>[global]
use-mirrors=true</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content" ref="easywins/20_options/6">
<p><code>PIP_USE_MIRRORS=true</code></p></div>
</div><div class="slide" data-transition="none"><div class="content incremental nobullets" ref="advanced/10_why/1">
<h2>sure, PyPI mirrors are nice</h2>

<ul>
<li>but</li>
<li><code>Some Project</code> host their own downloads</li>
<li>and now their site's down and I can't deploy</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="advanced/10_why/2">
<h2>if you want it done right, do it yourself</h2>

<ol>
<li><code>--index-url</code></li>
<li><code>--find-links</code></li>
<li><code>vendor/</code></li>
</ol>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced/20_index_url/1">
<h1>option 1</h1></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="advanced/20_index_url/2">
<h2>host your own index</h2>

<ul>
<li>pip lets us replace the default PyPI index URL (or add more index URLs)</li>
<li>directory per project, with links to sdists</li>
<li>automate with <code>chishop</code> (or <code>EggBasket</code>, <code>ClueReleaseManager</code>, <code>basketweaver</code>...)</li>
<li>can also accept <code>setup.py upload</code> like PyPI</li>
<li>just use <code>--index-url</code> option with base URL</li>
<li>or <code>--extra-index-url</code> if you want PyPI too</li>
<li>can go in reqs file (applies to whole file)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="advanced/20_index_url/3">
<p><code>--index-url http://myindex.example.com/</code></p>

<pre><code><code class="command">$ tree</code>
<code class="result">.
|-- Django
|   `-- Django-1.3.tar.gz
`-- django-floppyforms
    `-- django-floppyforms-0.4.2.tar.gz
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="advanced/20_index_url/4">
<h2>your own index</h2>

<ul>
<li>easy to upload internal packages with <code>setup.py upload</code></li>
<li>higher maintenance</li>
<li>separate from project but needs to be kept in sync</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced/30_find_links/1">
<h1>option 2</h1></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="advanced/30_find_links/2">
<h2>dump some tarballs in a directory</h2>

<ul>
<li><code>--find-links</code> can inject arbitrary URLs into the link-scraping</li>
<li>point it at a web-served directory of sdists with indexes on</li>
<li>this option can also go directly in a requirements file</li>
<li>file:// URLs work too, pip will get the directory listing</li>
<li>if you don't want PyPI used at all, add <code>--no-index</code></li>
<li>easily populate with <code>pip install -d my-sdists-dir/ SomePackage</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="advanced/30_find_links/3">
<p><code>--find-links http://internal.example.com/sdists/</code></p>

<p>or</p>

<p><code>--find-links file:///path/to/my/sdists/</code></p>

<pre><code><code class="command">$ tree</code>
<code class="result">.
|-- Django-1.3.tar.gz
`-- django-floppyforms-0.4.2.tar.gz
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="advanced/30_find_links/4">
<h2>find-links</h2>

<ul>
<li>trivial to maintain manually</li>
<li>very fast with <code>file://</code> URL and <code>--no-index</code></li>
<li>can be self-contained with project</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced/40_vendor/1">
<h1>option 3</h1></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="advanced/40_vendor/2">
<h2>commit deps (unpacked) in a vendor/ directory</h2>

<ul>
<li><code>pip install --install-option="--home=`pwd`/vendor/" ...</code></li>
<li><code>export PYTHONPATH=`pwd`/vendor/lib/python</code></li>
<li>commit <code>vendor/</code> with the rest of your code</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content commandline incremental" ref="advanced/40_vendor/3">
<pre><code><code class="command">$ tree -L 4</code>
<code class="result">.
`-- vendor
    |-- bin
    |   `-- django-admin.py
    `-- lib
        `-- python
            |-- django
            |-- Django-1.3-py2.6.egg-info
            |-- django_floppyforms-0.4.7-py2.6.egg-info
            `-- floppyforms
</code></code></pre></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="advanced/40_vendor/4">
<h2>vendor/</h2>

<ul>
<li>fastest, simplest deployment story (no moving parts)</li>
<li>platform/path issues with compiled extensions</li>
<li>requires path hackery (PYTHONPATH or runtime sys.path mods)</li>
<li>temptation to patch stuff directly in <code>vendor/</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content small nobullets" ref="other/10_vcs/1">
<h1>but what about VCS support?!?</h1>

<ul>
<li><code>-e git://github.com/carljm/django-model-utils@8c6c1cf8#egg=django-model-utils</code></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="other/10_vcs/2">
<h2>it's excellent</h2></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="other/10_vcs/3">
<h2>use it in development</h2></div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="other/10_vcs/4">
<h2>not for production deploys</h2>

<ul>
<li>more moving parts in every deploy</li>
<li>have to install VCSes on every server</li>
<li>VCS clones / checkouts are slow</li>
<li>every VCS host is another point of failure</li>
<li>internal releases are easy to make (<code>setup.py sdist</code>)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content incremental" ref="outro/01_out/1">
<h1>So.</h1>

<ul>
<li><code>pip</code> is flexible</li>
<li>Installing your dependencies can be fast and reliable.</li>
<li>Go make it so.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content nobullets" ref="outro/01_out/2">
<h1>Questions?</h1>

<h3>Resources:</h3>

<ul>
<li>pip-installer.org</li>
<li>virtualenv.org</li>
<li><code>#pip</code> on Freenode</li>
<li>groups.google.com/group/python-virtualenv</li>
<li>@carljm</li>
<li>carl@oddbird.net</li>
<li>slides: github.com/carljm/tamingdeps</li>
</ul>
</div>
</div></div>

</body>
</html>
